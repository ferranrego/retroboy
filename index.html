<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/retroboy/favicon.ico" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <link rel="apple-touch-icon" href="/retroboy/logo192.png" />
    <link rel="manifest" href="/retroboy/manifest.json" />
    <title>Retro Boy</title>
    <script defer src="/retroboy/static/js/main.924a52ff.js"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- Farcaster SDK Loader -->
    <script type="module">
      import { sdk } from 'https://esm.sh/@farcaster/frame-sdk';
      window.addEventListener('load', async () => {
        console.log("App loaded: calling sdk.actions.ready()");
        await sdk.actions.ready();
      });
    </script>

    <!-- Combined Inline Script: Load default ROM and modify UI -->
    <script>
      window.addEventListener('load', async function () {
        // Wait 500ms to ensure all elements and scripts are fully rendered.
        await new Promise((resolve) => setTimeout(resolve, 500));

        // 1. Load Default ROM
        try {
          console.log("Attempting to load default ROM...");
          const response = await fetch('https://ferranrego.github.io/retroboy/roms/default.gb');
          if (!response.ok) {
            throw new Error("Network response was not ok: " + response.status);
          }
          const buffer = await response.arrayBuffer();
          const romData = new Uint8Array(buffer);

          // Try method 1: Use global 'retroboy' object if available.
          if (window.retroboy && typeof window.retroboy.loadROM === 'function') {
            window.retroboy.loadROM(romData);
            console.log("Default ROM loaded via retroboy.loadROM()");
          }
          // Try method 2: Use global 'emulator' object if available.
          else if (window.emulator && typeof window.emulator.loadROM === 'function') {
            window.emulator.loadROM(romData);
            console.log("Default ROM loaded via emulator.loadROM()");
          }
          // Try method 3: Simulate file input selection if available.
          else {
            const fileInput = document.querySelector('input[type="file"]');
            if (fileInput) {
              const blob = new Blob([romData], { type: "application/octet-stream" });
              const file = new File([blob], "default.gb", { type: "application/octet-stream" });
              const dataTransfer = new DataTransfer();
              dataTransfer.items.add(file);
              fileInput.files = dataTransfer.files;
              fileInput.dispatchEvent(new Event('change', { bubbles: true }));
              console.log("Default ROM loaded by simulating file input change event.");
            } else {
              console.error("No known method to load ROM found.");
            }
          }
        } catch (error) {
          console.error("Error loading default ROM:", error);
        }

        // 2. Hide Unwanted UI Elements

        // Hide "Load ROM" button.
        const loadRomButton = [...document.querySelectorAll("button")].find(b =>
          b.innerText.trim().toLowerCase() === "load rom"
        );
        if (loadRomButton) loadRomButton.style.display = "none";

        // Hide "CONTROLS" button.
        const controlsButton = [...document.querySelectorAll("button")].find(b =>
          b.innerText.trim().toLowerCase() === "controls"
        );
        if (controlsButton) controlsButton.style.display = "none";

        // Hide "CHEATS" button.
        const cheatsButton = [...document.querySelectorAll("button")].find(b =>
          b.innerText.trim().toLowerCase() === "cheats"
        );
        if (cheatsButton) cheatsButton.style.display = "none";

        // Hide the RetroBoy logo.
        const logo = document.querySelector('img[alt*="RetroBoy"]') || document.querySelector('.logo');
        if (logo) {
          logo.style.display = "none";
          console.log("RetroBoy logo hidden.");
        }

        // Hide current room name (assumes an element contains "Room").
        const roomName = [...document.querySelectorAll("*")].find(el =>
          el.innerText && el.innerText.includes("Room")
        );
        if (roomName) {
          roomName.style.display = "none";
          console.log("Current room name hidden.");
        }

        // Hide the entire toggle for monochrome/color mode.
        const toggle = [...document.querySelectorAll("button")].find(b =>
          b.innerText && (b.innerText.toLowerCase().includes("mono") || b.innerText.toLowerCase().includes("color"))
        );
        if (toggle) {
          toggle.style.display = "none";
          console.log("Color/Mono toggle hidden.");
        }
      });
    </script>
  </body>
</html>

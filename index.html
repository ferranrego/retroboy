<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/retroboy/favicon.ico" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <link rel="apple-touch-icon" href="/retroboy/logo192.png" />
    <link rel="manifest" href="/retroboy/manifest.json" />
    <title>Retro Boy</title>
    <script defer src="/retroboy/static/js/main.924a52ff.js"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <!-- The main emulator UI is rendered inside this container -->
    <div id="root"></div>
    
    <!-- Farcaster SDK Loader -->
    <script type="module">
      import { sdk } from 'https://esm.sh/@farcaster/frame-sdk';
      window.addEventListener('load', async () => {
        console.log("App loaded: calling sdk.actions.ready()");
        await sdk.actions.ready();
      });
    </script>
    
    <!-- Combined Inline Script: Load default ROM and continuously hide unwanted UI elements -->
    <script>
      window.addEventListener('load', async function () {
        // Wait 1500ms to allow dynamic UI elements to render.
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // 1. Load Default ROM
        try {
          console.log("Attempting to load default ROM...");
          const response = await fetch('https://ferranrego.github.io/retroboy/roms/default.gb');
          if (!response.ok) {
            throw new Error("Network response was not ok: " + response.status);
          }
          const buffer = await response.arrayBuffer();
          const romData = new Uint8Array(buffer);
          
          if (window.retroboy && typeof window.retroboy.loadROM === 'function') {
            window.retroboy.loadROM(romData);
            console.log("Default ROM loaded via retroboy.loadROM()");
          } else if (window.emulator && typeof window.emulator.loadROM === 'function') {
            window.emulator.loadROM(romData);
            console.log("Default ROM loaded via emulator.loadROM()");
          } else {
            const fileInput = document.querySelector('input[type="file"]');
            if (fileInput) {
              const blob = new Blob([romData], { type: "application/octet-stream" });
              const file = new File([blob], "default.gb", { type: "application/octet-stream" });
              const dataTransfer = new DataTransfer();
              dataTransfer.items.add(file);
              fileInput.files = dataTransfer.files;
              fileInput.dispatchEvent(new Event('change', { bubbles: true }));
              console.log("Default ROM loaded by simulating file input change event.");
            } else {
              console.error("No known method to load ROM found.");
            }
          }
        } catch (error) {
          console.error("Error loading default ROM:", error);
        }
        
        // 2. Function to hide unwanted UI elements
        function hideUnwantedElements() {
          // (a) Hide description paragraphs that explain how to use Retro Boy.
          document.querySelectorAll("p").forEach(p => {
            let txt = p.innerText.toLowerCase();
            if (txt.includes("retro boy is a game boy emulator") &&
                txt.includes("load rom") &&
                txt.includes("play")) {
              p.style.display = "none";
            }
          });
          
          // (b) Hide elements that display the ROM name and separator.
          // Try common selectors: elements with classes "romName", "rom-info", "separator"
          document.querySelectorAll(".romName, .rom-info, .separator").forEach(el => {
            el.style.display = "none";
          });
          
          // (c) Hide any element containing a filename (".gb" or ".gbc") unless it's the play button.
          document.querySelectorAll("*").forEach(el => {
            if (el.innerText && (el.innerText.includes(".gb") || el.innerText.includes(".gbc"))) {
              if (!(el.tagName.toLowerCase() === "button" && el.innerText.trim().toLowerCase() === "play")) {
                el.style.display = "none";
              }
            }
          });
          
          // (d) Hide any element that contains the word "room" (case-insensitive).
          document.querySelectorAll("*").forEach(el => {
            if (el.innerText && el.innerText.toLowerCase().includes("room")) {
              el.style.display = "none";
            }
          });
          
          // (e) Hide all buttons except the one with text "play".
          document.querySelectorAll("button").forEach(btn => {
            if (btn.innerText.trim().toLowerCase() !== "play") {
              btn.style.display = "none";
            }
          });
        }
        
        // Run it once after the delay.
        hideUnwantedElements();
        
        // 3. Set up a MutationObserver to continuously hide unwanted elements in case they are reâ€‘inserted.
        const observer = new MutationObserver(() => {
          hideUnwantedElements();
        });
        observer.observe(document.body, { childList: true, subtree: true });
